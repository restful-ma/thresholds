openapi: 3.0.0
info:
  description: The Azure SQL Database management API provides a RESTful set of web APIs
    that interact with Azure SQL Database services to manage your databases. The
    API enables users to create, retrieve, update, and delete databases,
    servers, and other entities.
  title: SqlManagementClient
  version: 2017-10-01-preview
  x-apisguru-categories:
    - cloud
  x-logo:
    url: https://assets.onestore.ms/cdnfiles/onestorerolling-1606-01000/shell/v3/images/logo/microsoft.png
  x-origin:
    - format: swagger
      url: https://raw.githubusercontent.com/Azure/azure-rest-api-specs/master/specification/sql/resource-manager/Microsoft.Sql/preview/2017-10-01-preview/databaseVulnerabilityAssessmentScans.json
      version: "2.0"
  x-providerName: azure.com
  x-serviceName: sql-databaseVulnerabilityAssessmentScans
  x-tags:
    - Azure
    - Microsoft
paths:
  "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Sql/servers/{serverName}/databases/{databaseName}/vulnerabilityAssessments/{vulnerabilityAssessmentName}/scans":
    get:
      description: Lists the vulnerability assessment scans of a database.
      operationId: DatabaseVulnerabilityAssessmentScans_ListByDatabase
      parameters:
        - $ref: "#/components/parameters/ResourceGroupParameter"
        - $ref: "#/components/parameters/ServerNameParameter"
        - $ref: "#/components/parameters/DatabaseNameParameter"
        - description: The name of the vulnerability assessment.
          in: path
          name: vulnerabilityAssessmentName
          required: true
          x-ms-enum:
            modelAsString: true
            name: VulnerabilityAssessmentName
          schema:
            type: string
            enum:
              - default
          examples:
            Gets the list of a database vulnerability assessment scan records:
              value: default
        - $ref: "#/components/parameters/SubscriptionIdParameter"
        - $ref: "#/components/parameters/ApiVersionParameter"
      responses:
        "200":
          description: Successfully retrieved the database vulnerability assessment scan
            records.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VulnerabilityAssessmentScanRecordListRe\
                  sult"
              examples:
                Gets the list of a database vulnerability assessment scan records:
                  $ref: "#/components/examples/Gets_the_list_of_a_database_vulnerab\
                    ility_assessment_scan_records"
        default:
          description: >-
            *** Error Responses: ***

             * 400 InvalidStorageAccountName - The provided storage account is not valid or does not exist.

             * 400 InvalidStorageAccountCredentials - The provided storage account shared access signature or account storage key is not valid.

             * 400 VulnerabilityAssessmentInvalidPolicy - Vulnerability Assessment settings don't exist or invalid storage specified in settings. 

             * 400 DatabaseVulnerabilityAssessmentMissingStorageContainerPath - Storage container path must be provided if it isn't set in server level policy

             * 400 VulnerabilityAssessmentDatawarehouseDatabaseIsDeactivated - Could not execute Vulnerability Assessment operation because the database is paused. Please resume it.

             * 404 SubscriptionDoesNotHaveServer - The requested server was not found

             * 404 SourceDatabaseNotFound - The source database does not exist.

             * 404 DatabaseDoesNotExist - User has specified a database name that does not exist on this server instance.

             * 409 DatabaseVulnerabilityAssessmentScanIsAlreadyInProgress - Vulnerability Assessment scan is already in progress.

             * 500 DatabaseIsUnavailable - Loading failed. Please try again later.
      tags:
        - DatabaseVulnerabilityAssessmentScans
      x-ms-pageable:
        nextLinkName: nextLink
  "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Sql/servers/{serverName}/databases/{databaseName}/vulnerabilityAssessments/{vulnerabilityAssessmentName}/scans/{scanId}":
    get:
      description: Gets a vulnerability assessment scan record of a database.
      operationId: DatabaseVulnerabilityAssessmentScans_Get
      parameters:
        - $ref: "#/components/parameters/ResourceGroupParameter"
        - $ref: "#/components/parameters/ServerNameParameter"
        - $ref: "#/components/parameters/DatabaseNameParameter"
        - description: The name of the vulnerability assessment.
          in: path
          name: vulnerabilityAssessmentName
          required: true
          x-ms-enum:
            modelAsString: true
            name: VulnerabilityAssessmentName
          schema:
            type: string
            enum:
              - default
          examples:
            Gets a database vulnerability assessment scan record by scan ID:
              value: default
        - description: The vulnerability assessment scan Id of the scan to retrieve.
          in: path
          name: scanId
          required: true
          schema:
            type: string
          examples:
            Gets a database vulnerability assessment scan record by scan ID:
              value: scan001
        - $ref: "#/components/parameters/SubscriptionIdParameter"
        - $ref: "#/components/parameters/ApiVersionParameter"
      responses:
        "200":
          description: Successfully retrieved the database vulnerability assessment scan
            record.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VulnerabilityAssessmentScanRecord"
              examples:
                Gets a database vulnerability assessment scan record by scan ID:
                  $ref: "#/components/examples/Gets_a_database_vulnerability_assess\
                    ment_scan_record_by_scan_ID"
        default:
          description: >-
            *** Error Responses: ***

             * 400 InvalidStorageAccountName - The provided storage account is not valid or does not exist.

             * 400 InvalidStorageAccountCredentials - The provided storage account shared access signature or account storage key is not valid.

             * 400 VulnerabilityAssessmentInvalidPolicy - Vulnerability Assessment settings don't exist or invalid storage specified in settings. 

             * 400 DatabaseVulnerabilityAssessmentMissingStorageContainerPath - Storage container path must be provided if it isn't set in server level policy

             * 400 VulnerabilityAssessmentDatawarehouseDatabaseIsDeactivated - Could not execute Vulnerability Assessment operation because the database is paused. Please resume it.

             * 404 SubscriptionDoesNotHaveServer - The requested server was not found

             * 404 SourceDatabaseNotFound - The source database does not exist.

             * 404 DatabaseDoesNotExist - User has specified a database name that does not exist on this server instance.

             * 409 DatabaseVulnerabilityAssessmentScanIsAlreadyInProgress - Vulnerability Assessment scan is already in progress.

             * 500 DatabaseIsUnavailable - Loading failed. Please try again later.
      tags:
        - DatabaseVulnerabilityAssessmentScans
  "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Sql/servers/{serverName}/databases/{databaseName}/vulnerabilityAssessments/{vulnerabilityAssessmentName}/scans/{scanId}/export":
    post:
      description: Convert an existing scan result to a human readable format. If already
        exists nothing happens
      operationId: DatabaseVulnerabilityAssessmentScans_Export
      parameters:
        - $ref: "#/components/parameters/ResourceGroupParameter"
        - $ref: "#/components/parameters/ServerNameParameter"
        - description: The name of the scanned database.
          in: path
          name: databaseName
          required: true
          schema:
            type: string
          examples:
            Export a database's vulnerability assessment scan results.:
              value: testdb
        - description: The name of the vulnerability assessment.
          in: path
          name: vulnerabilityAssessmentName
          required: true
          x-ms-enum:
            modelAsString: true
            name: VulnerabilityAssessmentName
          schema:
            type: string
            enum:
              - default
          examples:
            Export a database's vulnerability assessment scan results.:
              value: default
        - description: The vulnerability assessment scan Id.
          in: path
          name: scanId
          required: true
          schema:
            type: string
          examples:
            Export a database's vulnerability assessment scan results.:
              value: scan001
        - $ref: "#/components/parameters/SubscriptionIdParameter"
        - $ref: "#/components/parameters/ApiVersionParameter"
      responses:
        "200":
          description: Scan result was converted successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DatabaseVulnerabilityAssessmentScansExp\
                  ort"
              examples:
                Export a database's vulnerability assessment scan results.:
                  $ref: "#/components/examples/Export_a_database_s_vulnerability_as\
                    sessment_scan_results."
        "201":
          description: Scan result was converted successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DatabaseVulnerabilityAssessmentScansExp\
                  ort"
              examples:
                Export a database's vulnerability assessment scan results.:
                  $ref: "#/components/examples/Export_a_database_s_vulnerability_as\
                    sessment_scan_results."
        default:
          description: >-
            *** Error Responses: ***

             * 400 InvalidStorageAccountName - The provided storage account is not valid or does not exist.

             * 400 InvalidStorageAccountCredentials - The provided storage account shared access signature or account storage key is not valid.

             * 400 VulnerabilityAssessmentInvalidPolicy - Vulnerability Assessment settings don't exist or invalid storage specified in settings. 

             * 400 DatabaseVulnerabilityAssessmentMissingStorageContainerPath - Storage container path must be provided if it isn't set in server level policy

             * 400 VulnerabilityAssessmentDatawarehouseDatabaseIsDeactivated - Could not execute Vulnerability Assessment operation because the database is paused. Please resume it.

             * 400 InvalidVulnerabilityAssessmentOperationRequest - The vulnerability assessment operation request does not exist or has no properties object.

             * 400 DataSecurityInvalidUserSuppliedParameter - An invalid parameter value was provided by the client.

             * 404 SubscriptionDoesNotHaveServer - The requested server was not found

             * 404 SourceDatabaseNotFound - The source database does not exist.

             * 404 DatabaseDoesNotExist - User has specified a database name that does not exist on this server instance.

             * 409 DatabaseVulnerabilityAssessmentScanIsAlreadyInProgress - Vulnerability Assessment scan is already in progress.

             * 500 DatabaseIsUnavailable - Loading failed. Please try again later.
      tags:
        - DatabaseVulnerabilityAssessmentScansExport
  "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Sql/servers/{serverName}/databases/{databaseName}/vulnerabilityAssessments/{vulnerabilityAssessmentName}/scans/{scanId}/initiateScan":
    post:
      description: Executes a Vulnerability Assessment database scan.
      operationId: DatabaseVulnerabilityAssessmentScans_InitiateScan
      parameters:
        - $ref: "#/components/parameters/ResourceGroupParameter"
        - $ref: "#/components/parameters/ServerNameParameter"
        - $ref: "#/components/parameters/DatabaseNameParameter"
        - description: The name of the vulnerability assessment.
          in: path
          name: vulnerabilityAssessmentName
          required: true
          x-ms-enum:
            modelAsString: true
            name: VulnerabilityAssessmentName
          schema:
            type: string
            enum:
              - default
          examples:
            Executes a database's vulnerability assessment scan.:
              value: default
        - description: The vulnerability assessment scan Id of the scan to retrieve.
          in: path
          name: scanId
          required: true
          schema:
            type: string
          examples:
            Executes a database's vulnerability assessment scan.:
              value: scan01
        - $ref: "#/components/parameters/SubscriptionIdParameter"
        - $ref: "#/components/parameters/ApiVersionParameter"
      responses:
        "200":
          description: Successfully executed a Vulnerability Assessment database scan.
        "202":
          description: Successfully started a Vulnerability Assessment database scan.
        default:
          description: >-
            *** Error Responses: ***

             * 400 InvalidVulnerabilityAssessmentOperationRequest - The vulnerability assessment operation request does not exist or has no properties object.

             * 400 DataSecurityInvalidUserSuppliedParameter - An invalid parameter value was provided by the client.

             * 400 InvalidVulnerabilityAssessmentScanIdLength - The vulnerability assessment scan ID length must be below {0} characters.

             * 400 InvalidStorageAccountName - The provided storage account is not valid or does not exist.

             * 400 InvalidStorageAccountCredentials - The provided storage account shared access signature or account storage key is not valid.

             * 400 VulnerabilityAssessmentInvalidPolicy - Vulnerability Assessment settings don't exist or invalid storage specified in settings. 

             * 400 DatabaseVulnerabilityAssessmentMissingStorageContainerPath - Storage container path must be provided if it isn't set in server level policy

             * 400 VulnerabilityAssessmentDatawarehouseDatabaseIsDeactivated - Could not execute Vulnerability Assessment operation because the database is paused. Please resume it.

             * 404 SubscriptionDoesNotHaveServer - The requested server was not found

             * 404 SourceDatabaseNotFound - The source database does not exist.

             * 404 DatabaseDoesNotExist - User has specified a database name that does not exist on this server instance.

             * 409 DatabaseVulnerabilityAssessmentScanIsAlreadyInProgress - Vulnerability Assessment scan is already in progress.

             * 500 DatabaseIsUnavailable - Loading failed. Please try again later.
      tags:
        - DatabaseVulnerabilityAssessmentScansExecute
      x-ms-long-running-operation: true
servers:
  - url: https://management.azure.com
components:
  examples:
    Gets_the_list_of_a_database_vulnerability_assessment_scan_records:
      value:
        value:
          - id: /subscriptions/00000000-1111-2222-3333-444444444444/resourceGroups/vulnerabilityassessmenttest-4799/providers/Microsoft.Sql/servers/vulnerabilityassessmenttest-6440/databases/testdb/vulnerabilityAssessments/default/scans/scan001
            name: scan001
            properties:
              endTime: 2017-12-12T17:47:06Z
              errors: []
              numberOfFailedSecurityChecks: 9
              scanId: scan001
              startTime: 2017-12-12T17:45:06Z
              state: Passed
              storageContainerPath: https://myaccount.blob.core.windows.net/vulnerability-assessment
              triggerType: OnDemand
            type: Microsoft.Sql/servers/databases/vulnerabilityAssessments/scans
          - id: /subscriptions/00000000-1111-2222-3333-444444444444/resourceGroups/vulnerabilityassessmenttest-4799/providers/Microsoft.Sql/servers/vulnerabilityassessmenttest-6440/databases/testdb/vulnerabilityAssessments/default/scans/scan002
            name: scan002
            properties:
              endTime: 2017-12-12T17:47:06Z
              errors: []
              numberOfFailedSecurityChecks: 9
              scanId: scan002
              startTime: 2017-12-12T17:45:06Z
              state: Failed
              storageContainerPath: https://myaccount.blob.core.windows.net/vulnerability-assessment
              triggerType: Recurring
            type: Microsoft.Sql/servers/databases/vulnerabilityAssessments/scans
          - id: /subscriptions/00000000-1111-2222-3333-444444444444/resourceGroups/vulnerabilityassessmenttest-4799/providers/Microsoft.Sql/servers/vulnerabilityassessmenttest-6440/databases/testdb/vulnerabilityAssessments/default/scans/scan003
            name: scan003
            properties:
              endTime: 2017-12-12T17:47:06Z
              errors:
                - code: StorageNotFound
                  message: Storage not found
              numberOfFailedSecurityChecks: 0
              scanId: scan003
              startTime: 2017-12-12T17:45:06Z
              state: FailedToRun
              storageContainerPath: https://myaccount.blob.core.windows.net/vulnerability-assessment
              triggerType: Recurring
            type: Microsoft.Sql/servers/databases/vulnerabilityAssessments/scans
    Gets_a_database_vulnerability_assessment_scan_record_by_scan_ID:
      value:
        id: /subscriptions/00000000-1111-2222-3333-444444444444/resourceGroups/vulnerabilityassessmenttest-4799/providers/Microsoft.Sql/servers/vulnerabilityassessmenttest-6440/databases/testdb/vulnerabilityAssessments/default/scans/scan001
        name: scan001
        properties:
          endTime: 2017-12-12T17:47:06Z
          errors: []
          numberOfFailedSecurityChecks: 9
          scanId: scan001
          startTime: 2017-12-12T17:45:06Z
          state: Passed
          storageContainerPath: https://myaccount.blob.core.windows.net/vulnerability-assessment
          triggerType: OnDemand
        type: Microsoft.Sql/servers/databases/vulnerabilityAssessments/scans
    Export_a_database_s_vulnerability_assessment_scan_results.:
      value:
        id: /subscriptions/00000000-1111-2222-3333-444444444444/resourceGroups/vulnerabilityassessmenttest-4799/providers/Microsoft.Sql/servers/vulnerabilityassessmenttest-6440/databases/testdb/vulnerabilityAssessments/default/scans/scan001/export
        name: scan001
        properties:
          exportedReportLocation: https://myaccount.blob.core.windows.net/vulnerabilityAssessment/vulnerabilityassessmenttest-6440/testdb/scan001.xlsx
        type: Microsoft.Sql/servers/databases/vulnerabilityAssessments/scans/export
  parameters:
    ApiVersionParameter:
      description: The API version to use for the request.
      in: query
      name: api-version
      required: true
      x-ms-parameter-location: client
      schema:
        type: string
      examples:
        Gets the list of a database vulnerability assessment scan records:
          value: 2017-10-01-preview
        Gets a database vulnerability assessment scan record by scan ID:
          value: 2017-10-01-preview
        Export a database's vulnerability assessment scan results.:
          value: 2017-10-01-preview
        Executes a database's vulnerability assessment scan.:
          value: 2017-10-01-preview
    BlobAuditingPolicyNameParameter:
      description: The name of the blob auditing policy.
      in: path
      name: blobAuditingPolicyName
      required: true
      x-ms-parameter-location: method
      schema:
        type: string
        enum:
          - default
    DatabaseNameParameter:
      description: The name of the database.
      in: path
      name: databaseName
      required: true
      x-ms-parameter-location: method
      schema:
        type: string
      examples:
        Gets the list of a database vulnerability assessment scan records:
          value: testdb
        Gets a database vulnerability assessment scan record by scan ID:
          value: testdb
        Executes a database's vulnerability assessment scan.:
          value: testdb
    ManagedInstanceNameParameter:
      description: The name of the managed instance.
      in: path
      name: managedInstanceName
      required: true
      x-ms-parameter-location: method
      schema:
        type: string
    ResourceGroupParameter:
      description: The name of the resource group that contains the resource. You can
        obtain this value from the Azure Resource Manager API or the portal.
      in: path
      name: resourceGroupName
      required: true
      x-ms-parameter-location: method
      schema:
        type: string
      examples:
        Gets the list of a database vulnerability assessment scan records:
          value: vulnerabilityassessmenttest-4711
        Gets a database vulnerability assessment scan record by scan ID:
          value: vulnerabilityassessmenttest-4711
        Export a database's vulnerability assessment scan results.:
          value: vulnerabilityassessmenttest-4799
        Executes a database's vulnerability assessment scan.:
          value: vulnerabilityassessmenttest-4711
    ServerNameParameter:
      description: The name of the server.
      in: path
      name: serverName
      required: true
      x-ms-parameter-location: method
      schema:
        type: string
      examples:
        Gets the list of a database vulnerability assessment scan records:
          value: vulnerabilityassessmenttest-6411
        Gets a database vulnerability assessment scan record by scan ID:
          value: vulnerabilityassessmenttest-6411
        Export a database's vulnerability assessment scan results.:
          value: vulnerabilityassessmenttest-6440
        Executes a database's vulnerability assessment scan.:
          value: vulnerabilityassessmenttest-6411
    SqlVirtualMachineContainerNameParameter:
      description: The name of the SqlVirtualMachineContainer.
      in: path
      name: sqlVirtualMachineContainerName
      required: true
      x-ms-parameter-location: method
      schema:
        type: string
    SqlVirtualMachineInstanceNameParameter:
      description: The name of the SqlVirtualMachineInstance.
      in: path
      name: sqlVirtualMachineInstanceName
      required: true
      x-ms-parameter-location: method
      schema:
        type: string
    SubscriptionIdParameter:
      description: The subscription ID that identifies an Azure subscription.
      in: path
      name: subscriptionId
      required: true
      x-ms-parameter-location: client
      schema:
        type: string
      examples:
        Gets the list of a database vulnerability assessment scan records:
          value: 00000000-1111-2222-3333-444444444444
        Gets a database vulnerability assessment scan record by scan ID:
          value: 00000000-1111-2222-3333-444444444444
        Export a database's vulnerability assessment scan results.:
          value: 00000000-1111-2222-3333-444444444444
        Executes a database's vulnerability assessment scan.:
          value: 00000000-1111-2222-3333-444444444444
    VirtualClusterNameParameter:
      description: The name of the virtual cluster.
      in: path
      name: virtualClusterName
      required: true
      x-ms-parameter-location: method
      schema:
        type: string
  securitySchemes:
    azure_auth:
      description: Azure Active Directory OAuth2 Flow
      type: oauth2
      flows:
        implicit:
          authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
          scopes:
            user_impersonation: impersonate your user account
  schemas:
    DatabaseVulnerabilityAssessmentScanExportProperties:
      description: Properties of the export operation's result.
      properties:
        exportedReportLocation:
          description: Location of the exported report (e.g.
            https://myStorage.blob.core.windows.net/VaScans/scans/serverName/databaseName/scan_scanId.xlsx).
          readOnly: true
          type: string
      type: object
    DatabaseVulnerabilityAssessmentScansExport:
      allOf:
        - allOf:
            - description: ARM resource.
              properties:
                id:
                  description: Resource ID.
                  readOnly: true
                  type: string
                name:
                  description: Resource name.
                  readOnly: true
                  type: string
                type:
                  description: Resource type.
                  readOnly: true
                  type: string
              type: object
              x-ms-azure-resource: true
          description: ARM proxy resource.
          properties: {}
          type: object
      description: A database Vulnerability Assessment scan export resource.
      properties:
        properties:
          $ref: "#/components/schemas/DatabaseVulnerabilityAssessmentScanExportProp\
            erties"
      type: object
    VulnerabilityAssessmentScanError:
      description: Properties of a vulnerability assessment scan error.
      properties:
        code:
          description: The error code.
          readOnly: true
          type: string
        message:
          description: The error message.
          readOnly: true
          type: string
      type: object
    VulnerabilityAssessmentScanRecord:
      allOf:
        - allOf:
            - description: ARM resource.
              properties:
                id:
                  description: Resource ID.
                  readOnly: true
                  type: string
                name:
                  description: Resource name.
                  readOnly: true
                  type: string
                type:
                  description: Resource type.
                  readOnly: true
                  type: string
              type: object
              x-ms-azure-resource: true
          description: ARM proxy resource.
          properties: {}
          type: object
      description: A vulnerability assessment scan record.
      properties:
        properties:
          $ref: "#/components/schemas/VulnerabilityAssessmentScanRecordProperties"
      type: object
    VulnerabilityAssessmentScanRecordListResult:
      description: A list of vulnerability assessment scan records.
      properties:
        nextLink:
          description: Link to retrieve next page of results.
          readOnly: true
          type: string
        value:
          description: Array of results.
          items:
            $ref: "#/components/schemas/VulnerabilityAssessmentScanRecord"
          readOnly: true
          type: array
      type: object
    VulnerabilityAssessmentScanRecordProperties:
      description: Properties of a vulnerability assessment scan record.
      properties:
        endTime:
          description: The scan end time (UTC).
          format: date-time
          readOnly: true
          type: string
        errors:
          description: The scan errors.
          items:
            $ref: "#/components/schemas/VulnerabilityAssessmentScanError"
          readOnly: true
          type: array
        numberOfFailedSecurityChecks:
          description: The number of failed security checks.
          format: int32
          readOnly: true
          type: integer
        scanId:
          description: The scan ID.
          readOnly: true
          type: string
        startTime:
          description: The scan start time (UTC).
          format: date-time
          readOnly: true
          type: string
        state:
          description: The scan status.
          enum:
            - Passed
            - Failed
            - FailedToRun
            - InProgress
          readOnly: true
          type: string
          x-ms-enum:
            modelAsString: true
            name: VulnerabilityAssessmentScanState
        storageContainerPath:
          description: The scan results storage container path.
          readOnly: true
          type: string
        triggerType:
          description: The scan trigger type.
          enum:
            - OnDemand
            - Recurring
          readOnly: true
          type: string
          x-ms-enum:
            modelAsString: true
            name: VulnerabilityAssessmentScanTriggerType
      type: object
